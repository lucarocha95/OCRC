<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Onde Cagar Running Club (OCRC)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f2f2f2;
            color: #333;
        }

        header {
            background-color: #a2d149;
            padding: 1rem;
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
        }

        #map {
            height: 80vh;
            width: 100%;
        }

        .popup-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .popup-section {
            margin-bottom: 0.5em;
        }

        .stars {
            color: #f39c12;
        }

        .filters {
            padding: 1rem;
            background-color: white;
        }

        .filters label,
        .filters select,
        .filters input {
            margin-right: 1rem;
            font-size: 1rem;
        }
    </style>
</head>

<body>
    <header>
        üöΩ Onde Cagar Running Club - OCRC üèÉ‚Äç‚ôÇÔ∏èüí®
    </header>

    <div class="filters">
        <label for="bairro">Bairro:</label>
        <select id="bairro">
            <option value="">Todos</option>
        </select>

        <label for="nota">Nota m√≠nima:</label>
        <input type="number" id="nota" min="0" max="5" step="0.5" value="0">

        <button onclick="filtrar()">Filtrar</button>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([-22.97, -43.2], 13); // Centra o mapa na posi√ß√£o m√©dia

        // Remove a camada padr√£o (se j√° existir)
        map.eachLayer(function (layer) {
            map.removeLayer(layer);
        });

        // Adiciona a nova camada com o estilo CartoDB minimalista
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://carto.com/">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);




        const bathrooms = [
            {
                "Banheiro": "Posto Ipiranga - Maria Quit√©ria",
                "Bairro": "Lagoa",
                "Endere√ßo": "Av. Epit√°cio Pessoa, 1354 - Ipanema, Rio de Janeiro - RJ, 22471-002",
                "Plus Code": "2Q9V+MF Ipanema, Rio de Janeiro - RJ",
                "Latitude": -22.9806791348418,
                "Longitude": -43.2063125045963,
                "Limpeza": 5,
                "Facilidade/Disponibilidade": 5,
                "Atendimento": 5,
                "Proximidade da Pista": 5,
                "Pre√ßo": 5,
                "Coment√°rios": "Melhor banheiro da lagoa, n√£o precisa nem falar com a atendente, s√≥ subir e usar. Limpo, sempre com papel.",
                "Avaliador": "Luca Rocha"
            },
            {
                "Banheiro": "Posto Ipiranga - Remo Botafogo",
                "Bairro": "Lagoa",
                "Endere√ßo": "Av. Epit√°cio Pessoa, 3666 - Lagoa, Rio de Janeiro - RJ, 22471-003",
                "Plus Code": "2QGR+MW Lagoa, Rio de Janeiro - RJ",
                "Latitude": -22.973124798948,
                "Longitude": -43.2076767757608,
                "Limpeza": 4,
                "Facilidade/Disponibilidade": 3,
                "Atendimento": 4,
                "Proximidade da Pista": 5,
                "Pre√ßo": 3,
                "Coment√°rios": "Bom banheiro, mas tem que pagar R$3,50. Atendentes simp√°ticos, mas rola aquele olhar desconfort√°vel de quem sabe que vai ter trabalho pra limpar o banheiro depois do caos.",
                "Avaliador": "Luca Rocha"
            },
            {
                "Banheiro": "Posto BR - Parque da Catacumba",
                "Bairro": "Lagoa",
                "Endere√ßo": "Av. Epit√°cio Pessoa, S/N - Lagoa, Rio de Janeiro - RJ, 22471-003",
                "Plus Code": "2QGW+VQ Lagoa, Rio de Janeiro - RJ",
                "Latitude": -22.9726643100373,
                "Longitude": -43.2030625045967,
                "Limpeza": 1,
                "Facilidade/Disponibilidade": 3,
                "Atendimento": 3,
                "Proximidade da Pista": 5,
                "Pre√ßo": 5,
                "Coment√°rios": "Nunca tem papel, muitas vezes o ch√£o estava alagado ou o banheiro interditado. N√£o recomendo",
                "Avaliador": "Luca Rocha"
            },
            {
                "Banheiro": "Hilton Copacabana",
                "Bairro": "Leme",
                "Endere√ßo": "Av. Atl√¢ntica, 1020 - Copacabana, Rio de Janeiro - RJ, 22010-000",
                "Plus Code": "2RPG+6M Copacabana, Rio de Janeiro - RJ",
                "Latitude": -22.9642794223069,
                "Longitude": -43.1733232334326,
                "Limpeza": 5,
                "Facilidade/Disponibilidade": 1,
                "Atendimento": 3,
                "Proximidade da Pista": 5,
                "Pre√ßo": 5,
                "Coment√°rios": "Tem que se humilhar para o seguran√ßa deixar voc√™ entrar no hotel para usar o banheiro. Extremamente limpo e confort√°vel.",
                "Avaliador": "Luca Rocha"
            },
            {
                "Banheiro": "Posto BR - Aterro do Flamengo",
                "Bairro": "Flamengo",
                "Endere√ßo": "Av. Infante Dom Henrique, S/N - Flamengo, Rio de Janeiro - RJ, 22021-140",
                "Plus Code": "3R9G+MM Flamengo, Rio de Janeiro - RJ",
                "Latitude": -22.9307505063117,
                "Longitude": -43.1733619859609,
                "Limpeza": 2,
                "Facilidade/Disponibilidade": 2,
                "Atendimento": 2,
                "Proximidade da Pista": 4,
                "Pre√ßo": 3,
                "Coment√°rios": "Atendentes sempre com m√° vontade, muitas vezes falaram que n√£o estava funcionando (mesmo tendo pessoas saindo) e o masculino n√£o tem vaso.",
                "Avaliador": "Luca Rocha"
            },
            {
                "Banheiro": "Marina da Gloria",
                "Bairro": "Gl√≥ria",
                "Endere√ßo": "Av. Infante Dom Henrique, S/N - Flamengo, Rio de Janeiro - RJ, 22021-140",
                "Plus Code": "3R9G+MM Flamengo, Rio de Janeiro - RJ",
                "Latitude": -22.9200722584758,
                "Longitude": -43.1693442353115,
                "Limpeza": 5,
                "Facilidade/Disponibilidade": 3,
                "Atendimento": 5,
                "Proximidade da Pista": 3,
                "Pre√ßo": 5,
                "Coment√°rios": "Banheiro bom, mas s√≥ funciona depois das 8AM. J√° fui salvo por um anjo que me levou no banheiro dos funcion√°rios.",
                "Avaliador": "Luca Rocha"
            },
            {
                "Banheiro": "Posto BR - Parque dos Patins",
                "Bairro": "Lagoa",
                "Endere√ßo": "Av. Borges de Medeiros, S/N - Lagoa, Rio de Janeiro - RJ, 22470-001",
                "Plus Code": "2QHJ+8X Lagoa, Rio de Janeiro - RJ",
                "Latitude": -22.9713870960151,
                "Longitude": -43.2176154655757,
                "Limpeza": 4,
                "Facilidade/Disponibilidade": 4,
                "Atendimento": 4,
                "Proximidade da Pista": 5,
                "Pre√ßo": 5,
                "Coment√°rios": "Bom banheiro, tem que pegar a chave na loja. As vezes n√£o tem papel.",
                "Avaliador": "Luca Rocha"
            },
            {
                "Banheiro": "Posto Ipiranga - Clube Militar",
                "Bairro": "Lagoa",
                "Endere√ßo": "Av. Borges de Medeiros, 3151 - Lagoa, Rio de Janeiro - RJ, 22470-001",
                "Plus Code": "2QPQ+X8 Lagoa, Rio de Janeiro - RJ",
                "Latitude": -22.9622032985759,
                "Longitude": -43.2116658915691,
                "Limpeza": 4,
                "Facilidade/Disponibilidade": 4,
                "Atendimento": 4,
                "Proximidade da Pista": 5,
                "Pre√ßo": 5,
                "Coment√°rios": "Simples bem feito. Banheiro limpo e espa√ßoso, mas tem que pegar a chave na loja.",
                "Avaliador": "Luca Rocha"
            }
        ];

        function renderStars(rating) {
            let stars = '';
            for (let i = 0; i < 5; i++) {
                stars += i < rating ?
                    '<i class="fas fa-star stars"></i>' :
                    '<i class="far fa-star stars"></i>';
            }
            return stars;
        }

        function calculateAverageRating(b) {
            const ratings = [
                b.Limpeza,
                b["Facilidade/Disponibilidade"],
                b.Atendimento,
                b["Proximidade da Pista"],
                b.Pre√ßo
            ];
            return (ratings.reduce((acc, r) => acc + r, 0) / ratings.length).toFixed(1);
        }

        function getColor(rating) {
            if (rating >= 4.5) return '#2ecc71';
            if (rating >= 3.5) return '#27ae60';
            if (rating >= 2.5) return '#f1c40f';
            if (rating >= 1.5) return '#e67e22';
            return '#e74c3c';
        }

        function getIcon(rating) {
            let color = 'red';
            if (rating >= 4.5) color = 'green';
            else if (rating >= 3.5) color = 'yellow';

            return L.icon({
                iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-${color}.png`,
                shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });
        }

        function filtrar() {
            const bairro = document.getElementById('bairro').value;
            const notaMinima = parseFloat(document.getElementById('nota').value.replace(',', '.')) || 0;

            map.eachLayer(layer => {
                if (layer instanceof L.Marker && !layer._url) map.removeLayer(layer);
            });

            bathrooms.forEach(b => {
                const avg = parseFloat(calculateAverageRating(b));
                if ((bairro === '' || b.Bairro === bairro) && avg >= notaMinima) {
                    const popup = `
        <div class="popup-title">${b.Banheiro}</div>
        <div class="popup-section"><strong>Bairro:</strong> ${b.Bairro}</div>
        <div class="popup-section"><strong>Endere√ßo:</strong> ${b.Endere√ßo}</div>
        <div class="popup-section"><strong>Nota Geral:</strong> ${avg}/5.0</div>
        <div class="popup-section"><strong>Notas:</strong><br>
          Limpeza: ${renderStars(b.Limpeza)}<br>
          Disponibilidade: ${renderStars(b["Facilidade/Disponibilidade"])}<br>
          Atendimento: ${renderStars(b.Atendimento)}<br>
          Proximidade: ${renderStars(b["Proximidade da Pista"])}<br>
          Pre√ßo: ${renderStars(b.Pre√ßo)}
        </div>
        <div class="popup-section"><strong>Coment√°rios:</strong> ${b.Coment√°rios || 'Sem coment√°rios'}</div>
      `;

                    L.marker([b.Latitude, b.Longitude], { icon: getIcon(avg) }).addTo(map).bindPopup(popup);
                }
            });
        }


        // Popular dropdown de bairros
        const bairrosUnicos = [...new Set(bathrooms.map(b => b.Bairro))];
        bairrosUnicos.forEach(b => {
            const option = document.createElement("option");
            option.value = b;
            option.textContent = b;
            document.getElementById("bairro").appendChild(option);
        });

        // Mostrar todos ao carregar
        filtrar();
    </script>
</body>

</html>